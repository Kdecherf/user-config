# A basic .muttrc for use with Gmail

set mbox_type=Maildir
set folder = ~/.mail
mailboxes `find ~/.mail/ -maxdepth 3 -type d -name cur -printf '"%h"\n'|grep -ve 'All Mail"$'|grep -ve 'Trash"$'|grep -ve 'Sent Mail"$' | sort -V | tr "\n" " "`

set editor = "vim"

set move = no
set timeout = 3          # idle time before scanning
set mail_check = 0       # minimum time between scans
set delete               # don't ask, just do
unset confirmappend      # don't ask, just do!
set quit                 # don't ask, just do!!
set include
set sort = 'threads'
set sort_aux = 'reverse-last-date-received'
set auto_tag = yes
unset mark_old

set send_charset="us-ascii:utf-8"

ignore "Authentication-Results:"
ignore "DomainKey-Signature:"
ignore "DKIM-Signature:"
hdr_order Date From To Cc
alternative_order text/plain text/html *
auto_view text/html
bind editor <Tab> complete-query
bind editor ^T complete
bind editor <space> noop

# Reply to all
bind index,pager R group-reply

# Don't record outgoing email: already done by Gmail
unset record

set index_format = "%4C (%4c) %Z %?GI?%GI& ? %[%d/%b]  %-20.19F %?K?%15.14K&               ? %?M?(%3M)&     ? %?X?Â¤& ? %s %> %?g?%g?"

# Composing
set forward_format = "Fwd: %s"
set forward_quote
unset mime_forward

set pager_stop
set smart_wrap
set fast_reply

set quote_regexp="^([ \t]*[>|])+"

bind index <space>  collapse-thread
bind index _ collapse-all
bind index r recall-message

bind index gg       first-entry
bind index G        last-entry
bind index,pager y delete-message

bind index,pager \Cy delete-thread

bind index L limit

macro index la "Lall<enter>" "Limit to all"
macro index ln "L~N<enter>" "Limit to new messages"

# Cheat code
macro index \Cr "T~U<enter><tag-prefix><clear-flag>N<untag-pattern>.<enter>" "Mark all messages as read"

macro index C "<copy-message>?<toggle-mailboxes>" "Copy a message to a mailbox"
macro index M "<save-message>?<toggle-mailboxes>" "Move a message to a mailbox"
macro index gl "<change-folder>?" "Move to label"

macro index D "<tag-prefix>d" "Move tagged messages to trash"

macro index \Cd "<tag-thread>d" "Move thread to trash"

macro index \Ca "<next-unread-mailbox><limit>~N<enter>" "Go to the next mailbox with unread messages"

# TODO: Sync email
# macro index O "<shell-escape>offlineimap<enter>"           "run offlineimap to sync all mail"
# macro index o "<shell-escape>offlineimap -qf INBOX<enter>" "run offlineimap to sync inbox"

# Source theme
source ~/.mutt/ivy-league.theme

# Source stuff
source ~/.mutt/smimerc
source ~/.mutt/gpgrc
source ~/.mutt/sidebar

# Source default account
source ~/.mutt/kdecherf.muttrc

# Source subscriptions
source ~/.mutt/subscriptions.muttrc

# Source color overload
source ~/.mutt/overload.theme
